<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Veo3 Generate Tool</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --text-color: #2d3436;
            --card-bg: #fff;
            --tab-bg: #fff;
            --tab-active-bg: #0984e3;
            --tab-hover-bg: #dfe6e9;
            --progress-bg: #dfe6e9;
            --progress-fill: #0984e3;
        }

        body {
            font-family: "Segoe UI", Tahoma, sans-serif;
            background: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-color);
        }

        .numberVideos input[type="number"] {
            width: 60px;
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        body.dark .numberVideos input[type="number"] {
            background: #444;
            color: #eee;
            border: 1px solid #555;
        }


        h1 {
            text-align: center;
            margin: 15px 0;
            font-size: 22px;
        }

        .tab {
            display: flex;
            justify-content: center;
            background: var(--tab-bg);
            border-bottom: 1px solid #dcdde1;
        }

        .tab button {
            flex: 1;
            padding: 10px 0;
            border: none;
            cursor: pointer;
            background: inherit;
            font-size: 15px;
            transition: 0.3s;
        }

        .tab button:hover {
            background: var(--tab-hover-bg);
        }

        .tab button.active {
            background: var(--tab-active-bg);
            color: white;
            font-weight: bold;
        }

        .tabcontent {
            display: none;
            padding: 15px;
        }

        #controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
            justify-content: center;
        }

        #controlsImg {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
            justify-content: center;
        }

        button.control-btn {
            padding: 6px 14px;
            border-radius: 5px;
            border: none;
            background: #0984e3;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
        }

        button.control-btn:hover {
            background: #74b9ff;
        }

        #excelContainer,
        #result {
            background: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dcdde1;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-size: 13px;
        }

        #excelContainerImg,
        #resultImg {
            background: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dcdde1;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-size: 13px;
        }

        progress {
            width: 100%;
            height: 14px;
            border-radius: 7px;
            background: var(--progress-bg);
            margin-top: 5px;
        }

        progress::-webkit-progress-value {
            background: var(--progress-fill);
            border-radius: 7px;
        }

        .accountInput {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 5px;
        }

        .accountInput input[type="text"] {
            flex: 1;
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .accountInput .removeAccount {
            padding: 4px 6px;
            border: none;
            border-radius: 4px;
            background: #e17055;
            color: white;
            cursor: pointer;
        }

        .accountInput .removeAccount:hover {
            background: #d63031;
        }

        body.dark {
            --bg-color: #1e1e2f;
            --text-color: #dcdde1;
            --card-bg: #2d2d3d;
            --tab-bg: #2d2d3d;
            --tab-active-bg: #0984e3;
            --tab-hover-bg: #3d3d4d;
            --progress-bg: #3d3d4d;
            --progress-fill: #74b9ff;
        }

        body.dark input {
            background: #444;
            color: #eee;
            border: 1px solid #555;
        }

        body.dark #accountsWrapper .accountInput {
            background: #2d2d3d;
            border: 1px solid #555;
        }

        #excelContainer table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-bottom: 10px;
        }

        #excelContainer th,
        #excelContainer td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
        }

        #excelContainer th {
            background-color: #0984e3;
            color: white;
        }

        #excelContainer tbody tr:nth-child(even) {
            background-color: #f0f2f5;
        }

        body.dark #excelContainer th {
            background-color: #0984e3;
            color: white;
        }

        body.dark #excelContainer tbody tr:nth-child(even) {
            background-color: #2d2d3d;
        }

        body.dark #excelContainer tbody tr {
            background-color: #2d2d3d;
            color: #eee;
        }

        #excelContainer {
            max-height: 250px;
            overflow-y: auto;
            background: var(--card-bg);
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #dcdde1;
        }




        #excelContainerImg table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-bottom: 10px;
        }

        #excelContainerImg th,
        #excelContainerImg td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
        }

        #excelContainerImg th {
            background-color: #0984e3;
            color: white;
        }

        #excelContainerImg tbody tr:nth-child(even) {
            background-color: #f0f2f5;
        }

        body.dark #excelContainerImg th {
            background-color: #0984e3;
            color: white;
        }

        body.dark #excelContainerImg tbody tr:nth-child(even) {
            background-color: #2d2d3d;
        }

        body.dark #excelContainerImg tbody tr {
            background-color: #2d2d3d;
            color: #eee;
        }

        #excelContainerImg {
            max-height: 250px;
            overflow-y: auto;
            background: var(--card-bg);
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #dcdde1;
        }
    </style>
</head>

<body>
    <div id="loginPopup" style="position:fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:9999;">
        <div style="background:#fff; padding:20px; border-radius:6px; width:300px; text-align:center;">
            <h2>Đăng nhập</h2>
            <input id="username" type="text" placeholder="Username" style="width:90%; margin-bottom:10px;"><br>
            <input id="password" type="password" placeholder="Password" style="width:90%; margin-bottom:10px;"><br>
            <button id="loginBtn">Login</button>
            <div id="errorMessage" style="color:red; margin-top:10px;"></div>
        </div>
    </div>
    <script>
        const usernameEl = document.getElementById("username");
        const passwordEl = document.getElementById("password");
        const errorEl = document.getElementById("errorMessage");
        const loginPopup = document.getElementById("loginPopup");
        const loginBtn = document.getElementById("loginBtn");

        async function login() {
            const username = usernameEl.value.trim();
            const password = passwordEl.value;

            if (!username || !password) {
                errorEl.innerText = "Vui lòng nhập username và password";
                return;
            }

            try {
                const result = await window.electronAPI.login({ username, password });
                if (result.success) {
                    loginPopup.style.display = "none"; // đóng popup
                    onLoginSuccess(result.user);
                    console.log("Login thành công:", result.user.username);
                } else {
                    errorEl.innerText = result.message;
                    passwordEl.value = "";
                    setTimeout(() => passwordEl.focus(), 10);
                }
            } catch (err) {
                errorEl.innerText = "Lỗi khi login";
                console.error(err);
            }
        }

        async function onLoginSuccess(user) {
            if (user.role === "admin") {
                document.getElementById("adminTabBtn").style.display = "inline-block";
                // document.getElementById("userTab").style.display = "block";
            } else {
                document.getElementById("adminTabBtn").style.display = "none";
                document.getElementById("userTab").style.display = "none";
            }
        }

        loginBtn.addEventListener("click", login);
        [usernameEl, passwordEl].forEach(el => {
            el.addEventListener("keypress", e => {
                if (e.key === "Enter") login();
            });
        });

        window.onload = () => usernameEl.focus();
    </script>

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event,'importTab')">Import</button>
        <button class="tablinks" onclick="openTab(event,'queueTab')">Hàng đợi</button>
        <button class="tablinks" onclick="openTab(event,'configTab')">Cấu hình</button>
        <button id="adminTabBtn" class="tablinks" onclick="openTab(event,'userTab')">Quản lý tài khoản</button>
    </div>

    <!-- Tab Import -->
    <div id="importTab" class="tabcontent" style="display:block;">
        <div id="controls">
            <button id="importExcel" class="control-btn">📂 Excel Gen Video</button>
        </div>
        <div hidden id="excelContainer"><i>Danh sách prompt Video</i></div>

        <div id="controlsImg">
            <button id="importExcelImg" class="control-btn">📂 Excel Gen Image</button>
        </div>
        <div hidden id="excelContainerImg"><i>Danh sách prompt Image</i></div>
    </div>


    <!-- Tab Queue -->
    <div id="queueTab" class="tabcontent">
        <div id="controls">
            <button id="generate" class="control-btn">▶ Generate Videos</button>
        </div>
        <div id="progressContainer"></div>
        <div id="result"><i>Log tạo video</i></div>

        <div id="controlsImg">
            <button id="generateImg" class="control-btn">▶ Generate Image</button>
        </div>
        <div id="progressContainerImg"></div>
        <div id="resultImg"><i>Log tạo Image</i></div>
    </div>

    <!-- Tab Config -->
    <div id="configTab" class="tabcontent">
        <h4 style="margin-top:10px;">Veo3 Accounts (chỉ chọn 1 account để login)</h4>
        <div id="accountsWrapper">
            <div class="accountInput" style="display:flex; align-items:center; gap:6px; margin-bottom:5px;">
                <input type="radio" name="selectedAccount" class="accountRadio" />
                <input type="text" placeholder="Tên Account 1" style="flex:1; padding:4px 6px;" />
                <button class="removeAccount">❌</button>
            </div>
        </div>
        <div style="margin-left:24px;">
            <label>Số video:</label>
            <input enable class="numberVideos" type="number" placeholder="2" min="1" max="4" value="2"
                style="width:60px; padding:4px 6px; border:1px solid #ccc; border-radius:4px;" />
        </div>
        <div style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-start;">
            <button id="addAccount" class="control-btn">➕ Thêm Account</button>
            <button id="saveConfig" class="control-btn">💾 Lưu cấu hình</button>
            <button id="loginAccount" class="control-btn">🔐 Login account</button>
            <button id="toggleDark" class="control-btn">🌙 Dark Mode</button>
        </div>
        <p style="font-size:12px;margin-top:8px;color:#666">
            Chọn 1 account trong danh sách rồi nhấn "Login account" để mở trình duyệt login Flow (lần đầu).
            Sau khi login, tool sẽ lưu session => Bấm "Lưu cấu hình".
        </p>
    </div>

    <div id="userTab" class="tabcontent">
        <h3>Quản lý tài khoản</h3>
        <div id="userList"></div>
        <button id="addUserBtn" onclick="showUserForm()">Thêm user</button>

        <div id="userFormWrapper" style="display:none; margin-top:20px; border:1px solid #ccc; padding:10px;">
            <h3 id="formTitle">Thêm user</h3>
            <input type="text" id="formUsername" placeholder="Username"><br><br>
            <input type="password" id="formPassword" placeholder="Password"><br><br>
            <select id="formRole">
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <div style="color: red" id="errorMessage"></div>
            <br><br>
            <button id="saveUserBtn">Lưu</button>
            <button id="cancelUserBtn">Hủy</button>
        </div>
    </div>
    <script src="renderer.js"></script>
    <script>
        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) tabcontent[i].style.display = "none";
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) tablinks[i].className = tablinks[i].className.replace(" active", "");
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>

</html>